#!/usr/bin/env python3

# Copyright Paul Adams, 2020. All rights reserved.
# Unauthorised reproduction is prohibited.

import sys
import config
from typing import Dict
from datetime import date as Date
from colorama import init as colorinit
from commands import Command, tasks, timetable
from argparse import ArgumentParser as ArgumentsParser, Namespace as Arguments

# Create the storage directory if it doesn't exist
if not config.PATH.is_dir():
    config.PATH.mkdir()

# Init colourful output
colorinit()

# Create the root parser
parser: ArgumentsParser = ArgumentsParser(
    description='Retrieve your timetable, tasks and more from Firefly',
    epilog='Copyright %s, %d. All rights reserved.' % (config.AUTHOR, Date.today().year)
)

# Create the root command instance
cmd: Command = Command(
    parser=parser,
    subcommands=[
        tasks.GetTasks,
        timetable.GetTimetable
    ]
)

try:
    # Parse the arguments
    args: Arguments = cmd.parser.parse_args()
    # Execute the command 
    args.func(args)
except Exception as e:
    sys.exit(e)